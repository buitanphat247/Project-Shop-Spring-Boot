<div th:replace="~{layouts/main-layout :: layout('Tin tức - THE MONA', ~{::content})}">
  <div th:fragment="content">
    <main class="container mx-auto px-4 py-8 flex flex-col">
      <div class="flex gap-8 items-start">
        <!-- Gallery -->
        <section
          id="product-gallery"
          class="w-[50%] lg:col-span-6 bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden relative self-start"
        >
          <span class="badge-sale z-10">SALE!</span>

          <!-- Swiper Main - Sẽ được render bằng JavaScript -->
          <div class="swiper pd-main">
            <div class="swiper-wrapper" id="pdMainWrapper">
              <!-- Loading state -->
                <div class="swiper-slide">
                <div class="w-full h-96 bg-gray-200 animate-pulse flex items-center justify-center">
                  <i class="fas fa-spinner fa-spin text-4xl text-gray-400"></i>
                </div>
              </div>
            </div>
          </div>

          <!-- Swiper Thumbs - Sẽ được render bằng JavaScript -->
          <div class="swiper pd-thumbs">
            <div class="swiper-wrapper" id="pdThumbsWrapper">
              <!-- Loading state -->
                <div class="swiper-slide">
                <div class="w-full h-20 bg-gray-200 animate-pulse rounded"></div>
              </div>
            </div>
          </div>
        </section>

        <!-- Info -->
        <section
          id="product-info"
          class="flex-1 lg:col-span-6 bg-white rounded-2xl shadow-sm border border-gray-200 p-6 flex flex-col justify-between h-full"
        >
          <!-- Error Message -->
          <div th:if="${error != null}" class="bg-red-100 border border-red-400 text-red-700 px-3 py-2 rounded text-sm mb-4">
            <span th:text="${error}"></span>
          </div>

          <!-- Product Data - Sẽ được render bằng JavaScript -->
          <div id="product-data" class="flex flex-col h-full">
            <!-- Loading state -->
            <div id="product-loading" class="flex flex-col h-full">
            <div class="mb-6">
                <div class="animate-pulse">
                  <div class="h-8 bg-gray-200 rounded mb-3"></div>
              <div class="flex items-center gap-3 mb-4">
                    <div class="h-8 w-32 bg-gray-200 rounded"></div>
                    <div class="h-6 w-24 bg-gray-200 rounded-full"></div>
              </div>
              </div>
            </div>
            <div class="mb-6">
                <div class="animate-pulse">
              <div class="flex items-center gap-3 mb-4">
                    <div class="h-10 w-32 bg-gray-200 rounded-lg"></div>
                    <div class="h-10 flex-1 bg-gray-200 rounded-full"></div>
                    <div class="h-10 w-10 bg-gray-200 rounded-full"></div>
                </div>
              </div>
            </div>
            <div class="mt-auto">
              <div class="bg-gray-50 rounded-lg p-4 space-y-3">
                  <div class="animate-pulse space-y-3">
                    <div class="h-4 bg-gray-200 rounded"></div>
                    <div class="h-4 bg-gray-200 rounded"></div>
                    <div class="h-4 bg-gray-200 rounded"></div>
                    <div class="h-4 bg-gray-200 rounded"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>

        </section>
      </div>

      <!-- Tabs -->
      <div class="mt-10 bg-white rounded-2xl shadow-sm border border-gray-200 p-6">
        <div class="flex items-center gap-6 border-b mb-6">
          <button class="py-3 font-bold text-[#cb5439] border-b-2 border-[#cb5439]" onclick="showTab('desc')">MÔ TẢ</button>
          <button class="py-3 font-bold text-gray-600 hover:text-[#cb5439] border-b-2 border-transparent" onclick="showTab('info')">
            THÔNG TIN BỔ SUNG
          </button>
          <button class="py-3 font-bold text-gray-600 hover:text-[#cb5439] border-b-2 border-transparent" onclick="showTab('review')">
            ĐÁNH GIÁ (0)
          </button>
        </div>
        <div id="tab-desc" class="text-gray-700 leading-relaxed">
          <p class="mb-4">Đang tải mô tả sản phẩm...</p>
        </div>
        <div id="tab-info" class="text-gray-700 leading-relaxed hidden">
          <div class="overflow-x-auto">
            <table class="min-w-full text-sm border border-gray-200 rounded-lg overflow-hidden">
              <tbody>
                <tr class="odd:bg-white even:bg-gray-50">
                  <td class="w-1/3 font-medium text-[#1f2d3d] p-3 border-b border-gray-200">Xuất xứ</td>
                  <td class="p-3 border-b border-gray-200">Việt Nam</td>
                </tr>
                <tr class="odd:bg-white even:bg-gray-50">
                  <td class="font-medium text-[#1f2d3d] p-3 border-b border-gray-200">Chất liệu</td>
                  <td class="p-3 border-b border-gray-200">100% Cotton</td>
                </tr>
                <tr class="odd:bg-white even:bg-gray-50">
                  <td class="font-medium text-[#1f2d3d] p-3 border-b border-gray-200">Hướng dẫn giặt</td>
                  <td class="p-3 border-b border-gray-200">Giặt máy 30°C, lộn trái, không tẩy</td>
                </tr>
                <tr class="odd:bg-white even:bg-gray-50">
                  <td class="font-medium text-[#1f2d3d] p-3 border-b border-gray-200">Size</td>
                  <td class="p-3 border-b border-gray-200">S, M, L, XL</td>
                </tr>
                <tr class="odd:bg-white even:bg-gray-50">
                  <td class="font-medium text-[#1f2d3d] p-3 border-b border-gray-200">Màu sắc</td>
                  <td class="p-3 border-b border-gray-200">Đen, Trắng, Xám</td>
                </tr>
                <tr class="odd:bg-white even:bg-gray-50">
                  <td class="font-medium text-[#1f2d3d] p-3">Mã sản phẩm</td>
                  <td class="p-3">TEE001</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        <div id="tab-review" class="hidden">
          <h4 class="text-lg font-semibold text-[#1f2d3d] mb-4">Be the first to review “Áo Thun Nam Cotton”</h4>
          <form id="reviewForm" class="space-y-4">
            <div>
              <label class="block text-sm text-gray-700 mb-1">Tên*</label>
              <input
                type="text"
                class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#cb5439]"
                placeholder="Nguyễn Văn A"
                required
              />
            </div>
            <div>
              <label class="block text-sm text-gray-700 mb-1">Email*</label>
              <input
                type="email"
                class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#cb5439]"
                placeholder="you@example.com"
                required
              />
            </div>
            <label class="inline-flex items-center gap-2 text-sm text-gray-600"
              ><input type="checkbox" class="accent-[#cb5439]" /> Lưu tên của tôi, email, và trang web trong trình duyệt này cho lần bình luận kế tiếp
              của tôi.</label
            >
            <div>
              <label class="block text-sm text-gray-700 mb-1">Đánh giá của bạn</label>
              <div id="rvStars" class="flex gap-1 text-xl text-gray-300 cursor-pointer select-none">
                <i data-v="1" class="fa-solid fa-star"></i>
                <i data-v="2" class="fa-solid fa-star"></i>
                <i data-v="3" class="fa-solid fa-star"></i>
                <i data-v="4" class="fa-solid fa-star"></i>
                <i data-v="5" class="fa-solid fa-star"></i>
              </div>
            </div>
            <div>
              <label class="block text-sm text-gray-700 mb-1">Đánh giá của bạn</label>
              <textarea
                rows="6"
                class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#cb5439]"
                placeholder="Hãy chia sẻ cảm nhận của bạn..."
                required
              ></textarea>
            </div>
            <button type="submit" class="bg-[#cb5439] text-white px-5 py-2 rounded-full hover:bg-[#a8442f]">GỬI ĐÁNH GIÁ</button>
          </form>
        </div>
      </div>

      <!-- Related products -->
      <section class="mt-10">
        <h2 class="text-2xl font-bold text-center text-[#2f604a] mb-6">SẢN PHẨM LIÊN QUAN</h2>
        <div id="relatedProducts" class="grid grid-cols-5 gap-4">
          <!-- Loading state -->
          <div class="col-span-5 flex justify-center items-center py-8">
            <div class="flex items-center space-x-2">
              <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-[#cb5439]"></div>
              <span class="text-gray-600">Đang tải sản phẩm liên quan...</span>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>
</div>

<!-- JavaScript for product detail page -->
<script defer src="/js/client/productDetail/utils.js"></script>
<script defer src="/js/client/productDetail/cart.js"></script>
<script defer src="/js/client/productDetail/product-data.js"></script>
<script defer src="/js/client/productDetail/related-products.js"></script>
<script defer src="/js/client/productDetail/ui.js"></script>
<script defer src="/js/client/productDetail/swiper.js"></script>
<script defer src="/js/client/productDetail/main.js"></script>

<!-- CSS cho loading states -->
<style>
  .animate-pulse {
    animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
  }
  
  @keyframes pulse {
    0%, 100% {
      opacity: 1;
    }
    50% {
      opacity: .5;
    }
  }
  
  /* Loading skeleton styles */
  .loading-skeleton {
    background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
    background-size: 200% 100%;
    animation: loading 1.5s infinite;
  }
  
  @keyframes loading {
    0% {
      background-position: 200% 0;
    }
    100% {
      background-position: -200% 0;
    }
  }
  
  /* Smooth transitions */
  .product-transition {
    transition: opacity 0.3s ease-in-out;
  }
  
  .product-transition.loading {
    opacity: 0.7;
  }
  
  .product-transition.loaded {
    opacity: 1;
  }
  
  /* Related products grid */
  #relatedProducts {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 1rem;
  }
  
  #relatedProducts .product-card {
    height: auto; /* Chiều cao tự động */
    transition: transform 0.2s ease;
  }
  
  #relatedProducts .product-card:hover {
    transform: translateY(-2px);
  }
  
  /* Responsive cho mobile */
  @media (max-width: 1024px) {
    #relatedProducts {
      grid-template-columns: repeat(3, 1fr); /* 3 cột trên tablet */
    }
  }
  
  @media (max-width: 768px) {
    #relatedProducts {
      grid-template-columns: repeat(2, 1fr); /* 2 cột trên mobile */
    }
  }
  
  @media (max-width: 480px) {
    #relatedProducts {
      grid-template-columns: 1fr; /* 1 cột trên mobile nhỏ */
    }
  }
</style>
